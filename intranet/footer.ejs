<!-- begin::User Panel-->
<div id="kt_quick_user" class="offcanvas offcanvas-right p-10">
	<!--begin::Header-->
	<div class="offcanvas-header d-flex align-items-center justify-content-between pb-5">
		<h3 id="profile_title_user" class="font-weight-bold m-0">User Profile</h3>
		<a href="#" class="btn btn-xs btn-icon btn-light btn-hover-primary" id="kt_quick_user_close">
			<i class="ki ki-close icon-xs text-muted"></i>
		</a>
	</div>
	<!--end::Header-->
	<!--begin::Content-->
	<div class="offcanvas-content pr-5 mr-n5">
		<!--begin::Header-->
		<div class="d-flex align-items-center mt-5">
			<div class="d-flex flex-column" style="width:100%;">
				<a href="#" class="font-weight-bold font-size-h5 text-dark-75 text-hover-primary" id="UserPanel_1"></a>
				<div class="text-muted mt-1" id="UserPanel_2"></div>
				<div class="navi mt-1">
					<a href="#" class="navi-item">
						<span class="navi-link p-0 pb-2">
							<span class="navi-icon mr-1">
								<span class="svg-icon svg-icon-lg svg-icon-primary">
									<!--begin::Svg Icon | path:assets/media/svg/icons/Communication/Mail-notification.svg-->
									<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
										<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
											<rect x="0" y="0" width="24" height="24" />
											<path d="M21,12.0829584 C20.6747915,12.0283988 20.3407122,12 20,12 C16.6862915,12 14,14.6862915 14,18 C14,18.3407122 14.0283988,18.6747915 14.0829584,19 L5,19 C3.8954305,19 3,18.1045695 3,17 L3,8 C3,6.8954305 3.8954305,6 5,6 L19,6 C20.1045695,6 21,6.8954305 21,8 L21,12.0829584 Z M18.1444251,7.83964668 L12,11.1481833 L5.85557487,7.83964668 C5.4908718,7.6432681 5.03602525,7.77972206 4.83964668,8.14442513 C4.6432681,8.5091282 4.77972206,8.96397475 5.14442513,9.16035332 L11.6444251,12.6603533 C11.8664074,12.7798822 12.1335926,12.7798822 12.3555749,12.6603533 L18.8555749,9.16035332 C19.2202779,8.96397475 19.3567319,8.5091282 19.1603533,8.14442513 C18.9639747,7.77972206 18.5091282,7.6432681 18.1444251,7.83964668 Z" fill="#000000" />
											<circle fill="#000000" opacity="0.3" cx="19.5" cy="17.5" r="2.5" />
										</g>
									</svg>
									<!--end::Svg Icon-->
								</span>
							</span>
							<span class="navi-text text-muted text-hover-primary" id="UserPanel_3"></span>
						</span>
					</a>
					<button type="button" id="chat_btn_quit" class="btn btn-danger btn-md text-uppercase font-weight-bold chat-send py-2 px-6" onclick="deleteCookies()" style='width:100%;margin-top:15px;'>Quit</button>
				</div>
			</div>
		</div>
		<!--end::Header-->
	</div>
	<!--end::Content-->
</div>
<!-- end::User Panel-->

<!--begin::Chat Panel-->
<div class="modal modal-sticky modal-sticky-bottom-right" id="kt_chat_modal" role="dialog" data-backdrop="false">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<!--begin::Card-->
			<div class="card card-custom">
				<!--begin::Header-->
				<div class="card-header align-items-center px-4 py-3">
					<div class="text-left flex-grow-1"></div>
					<div class="text-center flex-grow-1">
						<div class="text-dark-75 font-weight-bold font-size-h5" id="ChatMainName"></div>
						<!--div>
							<span class="label label-dot label-success"></span>
							<span class="font-weight-bold text-muted font-size-sm">Active</span>
						</div-->
					</div>
					<div class="text-right flex-grow-1">
						<button type="button" class="btn btn-clean btn-sm btn-icon btn-icon-md" data-dismiss="modal">
							<i class="ki ki-close icon-1x"></i>
						</button>
					</div>
				</div>
				<!--end::Header-->
				<!--begin::Body-->
				<div class="card-body">
					<!--begin::Scroll-->
					<div class="scroll scroll-pull" data-height="375" data-mobile-height="300" id="LiveChatScrollDiv">
						<!--begin::Messages-->
						<div class="messages" id="LiveChatDiv"></div>
						<!--end::Messages-->
					</div>
					<!--end::Scroll-->
				</div>
				<!--end::Body-->
				<!--begin::Footer-->
				<div class="card-footer align-items-center">
					<!--begin::Compose-->
					<textarea id="chat_input_message" class="form-control border-0 p-0" rows="2" placeholder="Type a message"></textarea>
					<div class="d-flex align-items-center justify-content-between mt-5">
						<div class="mr-3"></div>
						<div>
							<button type="button" id="chat_btn_send" class="btn btn-primary btn-md text-uppercase font-weight-bold chat-send py-2 px-6" onclick="sendMitarbeiterChatTextarea()">Send</button>
						</div>
					</div>
					<!--begin::Compose-->
				</div>
				<!--end::Footer-->
			</div>
			<!--end::Card-->
		</div>
	</div>
</div>
<!--end::Chat Panel-->
<!--begin::Scrolltop-->
<div id="kt_scrolltop" class="scrolltop">
	<span class="svg-icon">
		<!--begin::Svg Icon | path:assets/media/svg/icons/Navigation/Up-2.svg-->
		<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
			<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
				<polygon points="0 0 24 0 24 24 0 24" />
				<rect fill="#000000" opacity="0.3" x="11" y="10" width="2" height="10" rx="1" />
				<path d="M6.70710678,12.7071068 C6.31658249,13.0976311 5.68341751,13.0976311 5.29289322,12.7071068 C4.90236893,12.3165825 4.90236893,11.6834175 5.29289322,11.2928932 L11.2928932,5.29289322 C11.6714722,4.91431428 12.2810586,4.90106866 12.6757246,5.26284586 L18.6757246,10.7628459 C19.0828436,11.1360383 19.1103465,11.7686056 18.7371541,12.1757246 C18.3639617,12.5828436 17.7313944,12.6103465 17.3242754,12.2371541 L12.0300757,7.38413782 L6.70710678,12.7071068 Z" fill="#000000" fill-rule="nonzero" />
			</g>
		</svg>
		<!--end::Svg Icon-->
	</span>
</div>
<!--end::Scrolltop-->

<!--begin::Global Config(global config for global JS scripts)-->
<script>var KTAppSettings = { "breakpoints": { "sm": 576, "md": 768, "lg": 992, "xl": 1200, "xxl": 1400 }, "colors": { "theme": { "base": { "white": "#ffffff", "primary": "#3E97FF", "secondary": "#E5EAEE", "success": "#08D1AD", "info": "#844AFF", "warning": "#F5CE01", "danger": "#FF3D60", "light": "#E4E6EF", "dark": "#181C32" }, "light": { "white": "#ffffff", "primary": "#DEEDFF", "secondary": "#EBEDF3", "success": "#D6FBF4", "info": "#6125E1", "warning": "#FFF4DE", "danger": "#FFE2E5", "light": "#F3F6F9", "dark": "#D6D6E0" }, "inverse": { "white": "#ffffff", "primary": "#ffffff", "secondary": "#3F4254", "success": "#ffffff", "info": "#ffffff", "warning": "#ffffff", "danger": "#ffffff", "light": "#464E5F", "dark": "#ffffff" } }, "gray": { "gray-100": "#F3F6F9", "gray-200": "#EBEDF3", "gray-300": "#E4E6EF", "gray-400": "#D1D3E0", "gray-500": "#B5B5C3", "gray-600": "#7E8299", "gray-700": "#5E6278", "gray-800": "#3F4254", "gray-900": "#181C32" } }, "font-family": "Poppins" };</script>
<!--end::Global Config-->

<script src="assets/js/jquery-3.1.0.js"></script>
<script>
	languageInnerHTMLArr.push(new languageObj("modal_title_detail", "Detail", "Detail", "D√©tail", "ËØ¶ÊÉÖ"));
	languageInnerHTMLArr.push(new languageObj("button_modal_close", "Close", "Schlie√üen", "Fermer", "ÂÖ≥Èó≠"));
	languageInnerHTMLArr.push(new languageObj("button_modal_save", "Save", "Speichern", "Enregistrer", "‰øùÂ≠ò"));
	languageInnerHTMLArr.push(new languageObj("modal_title_add_new", "Add new", "Neu hinzuf√ºgen", "Ajouter nouveau", "Êñ∞Â¢û"));
	languageInnerHTMLArr.push(new languageObj("button_add_close", "Close", "Schlie√üen", "Fermer", "ÂÖ≥Èó≠"));
	languageInnerHTMLArr.push(new languageObj("button_add_save", "Save", "Speichern", "Enregistrer", "‰øùÂ≠ò"));
	languageInnerHTMLArr.push(new languageObj("card_label_result", "Result:", "Ergebnis:", "R√©sultat:", "ÁªìÊûúÔºö"));
	languageInnerHTMLArr.push(new languageObj("chat_btn_send", "Send", "Senden", "Envoyer", "ÂèëÈÄÅ"));
	languagePlaceholderArr.push(new languageObj("chat_input_message", "Type a message", "Nachricht eingeben", "Tapez un message", "ËæìÂÖ•Ê∂àÊÅØ"));
	languageInnerHTMLArr.push(new languageObj("profile_title_user", "User Profile", "Benutzerprofil", "Profil utilisateur", "Áî®Êà∑ËµÑÊñô"));
	languageInnerHTMLArr.push(new languageObj("chat_btn_quit", "Quit", "Beenden", "Quitter", "ÈÄÄÂá∫"));


</script>



<script>
	//ÂøÖÈ°ªÂú®ËØ≠Ë®ÄÂØπË±°Êï∞ÁªÑÁöÑÊúÄÂêéÈù¢
	applyLanguageInnerHTML();
	applyLanguagePlaceholder();
	applyLanguageValue();
	
	document.getElementById("ChatMainName").innerHTML = Vorname + " " + Nachname;
	document.getElementById("UserPanel_1").innerHTML = Vorname + " " + Nachname;
	document.getElementById("UserPanel_2").innerHTML = getRolleName(Rolle);
	document.getElementById("UserPanel_3").innerHTML = Email;
	
	var ChatArr = new Array();
	var lastChatPrIDX = 0;
	
	function myRepeatingFunction() {
	  console.log('üì© Chat function triggered every 5 seconds');
	  // ÂèØÂú®Ê≠§Ë∞ÉÁî®Âà∑Êñ∞Ê∂àÊÅØ„ÄÅÂèëÂøÉË∑≥ËØ∑Ê±ÇÁ≠âÈÄªËæë
	}
	
	function sendMitarbeiterChatTextarea(){
		var Chat = escape(document.getElementById("chat_input_message").value);
		var sql = "INSERT INTO `laaver`.mitarbeiter_chat (MitarbeiterID, Vorname, Nachname, Nachricht) VALUES ("+MitarbeiterID+", '" + Vorname + "', '" + Nachname + "', '" + Chat + "') ";	
		$.ajax({
			type: "POST",
			url: "/General_Insert",
			contentType: 'application/x-www-form-urlencoded',
			async: true,
			cache: false,
			data: {
				SQL_TXT: escape(sql),
			},
			success: function (response) {
				document.getElementById("chat_input_message").value = "";
				updateMitarbeiterChat();
			},
			error: function (xhr, status, error) {
				console.error("Node AJAX ËØ∑Ê±ÇÂ§±Ë¥•: ", status, error);
			}
		});  					
	}
	
	function updateMitarbeiterChat(){
		var sql = "SELECT * FROM `laaver`.mitarbeiter_chat WHERE prIDX>"+lastChatPrIDX+" ORDER BY prIDX DESC LIMIT 50 ";	
		$.ajax({
			type: "POST",
			url: "/Mitarbeiter_Nachricht",
			contentType: 'application/x-www-form-urlencoded',
			async: true,
			cache: false,
			data: {
				SQL_TXT: escape(sql),
			},
			success: function (response) {
				if(response.results.length>0){
					var tempChatArr = new Array();
					response.results.forEach(function (item) {
						tempChatArr.push(item);
					});
					
					tempChatArr.reverse();
					for(var i=0; i<tempChatArr.length; i++){
						ChatArr.push(tempChatArr);
					}

					var txt = "";
					for(var i=0; i<tempChatArr.length; i++){
						if(tempChatArr[i].MitarbeiterID == MitarbeiterID){
							txt +=  "<!--begin::Message Out-->"+
									"<div class='d-flex flex-column mb-5 align-items-end'>"+
									"<div class='d-flex align-items-center'>"+
									"<div>"+
									"<span class='text-muted font-size-sm'>"+convertUTCToGermanTime(tempChatArr[i].Datum)+"&nbsp;&nbsp;&nbsp;</span>"+
									"<a href='#' class='text-dark-75 text-hover-primary font-weight-bold font-size-h6'>"+unescape(tempChatArr[i].Vorname+" "+tempChatArr[i].Nachname)+"</a>"+
									"</div>"+
									"</div>"+
									"<div class='mt-2 rounded p-5 bg-light-primary text-dark-50 font-weight-bold font-size-lg text-right max-w-400px'>"+unescape(tempChatArr[i].Nachricht)+"</div>"+
									"</div>"+
									"<!--end::Message Out-->";
						}else{
							txt +=  "<!--begin::Message In-->"+
									"<div class='d-flex flex-column mb-5 align-items-start'>"+
									"<div class='d-flex align-items-center'>"+
									"<div>"+
									"<a href='#' class='text-dark-75 text-hover-primary font-weight-bold font-size-h6'>"+unescape(tempChatArr[i].Vorname+" "+tempChatArr[i].Nachname)+"</a>"+
									"<span class='text-muted font-size-sm'>&nbsp;&nbsp;&nbsp;"+convertUTCToGermanTime(tempChatArr[i].Datum)+"</span>"+
									"</div>"+
									"</div>"+
									"<div class='mt-2 rounded p-5 bg-light-success text-dark-50 font-weight-bold font-size-lg text-left max-w-400px'>"+unescape(tempChatArr[i].Nachricht)+"</div>"+
									"</div>"+
									"<!--end::Message In-->";
						}	
						
						if(i==tempChatArr.length-1) lastChatPrIDX = tempChatArr[i].prIDX;
					}
					document.getElementById("LiveChatDiv").innerHTML += txt;

					const chatDiv = document.getElementById('LiveChatScrollDiv');
					chatDiv.scrollTop = chatDiv.scrollHeight; 					
				}
			},
			error: function (xhr, status, error) {
				console.error("Node AJAX ËØ∑Ê±ÇÂ§±Ë¥•: ", status, error);
			}
		});  
	}
	
	function checkMitarbeiterChat(){
		ChatArr = new Array();
		var sql = "SELECT * FROM `laaver`.mitarbeiter_chat ORDER BY prIDX DESC LIMIT 50 ";	
		$.ajax({
			type: "POST",
			url: "/Mitarbeiter_Nachricht",
			contentType: 'application/x-www-form-urlencoded',
			async: true,
			cache: false,
			data: {
				SQL_TXT: escape(sql),
			},
			success: function (response) {
				response.results.forEach(function (item) {
					ChatArr.push(item);
				});
				
				ChatArr.reverse();
				
				if(ChatArr.length>0){
					document.getElementById("pulse-ring-span-1").style.display = "block";
				}else{
					document.getElementById("pulse-ring-span-1").style.display = "none";
				}	

				var txt = "";
				for(var i=0; i<ChatArr.length; i++){
					if(ChatArr[i].MitarbeiterID == MitarbeiterID){
						txt +=  "<!--begin::Message Out-->"+
								"<div class='d-flex flex-column mb-5 align-items-end'>"+
								"<div class='d-flex align-items-center'>"+
								"<div>"+
								"<span class='text-muted font-size-sm'>"+convertUTCToGermanTime(ChatArr[i].Datum)+"&nbsp;&nbsp;&nbsp;</span>"+
								"<a href='#' class='text-dark-75 text-hover-primary font-weight-bold font-size-h6'>"+unescape(ChatArr[i].Vorname+" "+ChatArr[i].Nachname)+"</a>"+
								"</div>"+
								"</div>"+
								"<div class='mt-2 rounded p-5 bg-light-primary text-dark-50 font-weight-bold font-size-lg text-right max-w-400px'>"+unescape(ChatArr[i].Nachricht)+"</div>"+
								"</div>"+
								"<!--end::Message Out-->";
					}else{
						txt +=  "<!--begin::Message In-->"+
								"<div class='d-flex flex-column mb-5 align-items-start'>"+
								"<div class='d-flex align-items-center'>"+
								"<div>"+
								"<a href='#' class='text-dark-75 text-hover-primary font-weight-bold font-size-h6'>"+unescape(ChatArr[i].Vorname+" "+ChatArr[i].Nachname)+"</a>"+
								"<span class='text-muted font-size-sm'>&nbsp;&nbsp;&nbsp;"+convertUTCToGermanTime(ChatArr[i].Datum)+"</span>"+
								"</div>"+
								"</div>"+
								"<div class='mt-2 rounded p-5 bg-light-success text-dark-50 font-weight-bold font-size-lg text-left max-w-400px'>"+unescape(ChatArr[i].Nachricht)+"</div>"+
								"</div>"+
								"<!--end::Message In-->";
					}	
					
					if(i==ChatArr.length-1) lastChatPrIDX = ChatArr[i].prIDX;
				}
				document.getElementById("LiveChatDiv").innerHTML = txt;				
			},
			error: function (xhr, status, error) {
				console.error("Node AJAX ËØ∑Ê±ÇÂ§±Ë¥•: ", status, error);
			}
		});  					
	}
	
	function showSuccessAlert(){
		setTimeout(function(){
			document.getElementById("success_button").click();
		},100);
	}
	
	$(document).ready(function () {
		if ($("#success_button").length > 0) {
			$("#success_button").click(function (e) {
				let msg = "";
				switch (lang) {
					case "en": msg = "Information has been updated!"; break;
					case "de": msg = "Information wurde aktualisiert!"; break;
					case "fr": msg = "Les informations ont √©t√© mises √† jour !"; break;
					case "cn": msg = "‰ø°ÊÅØÂ∑≤Êõ¥ÊîπÔºÅ"; break;
				}
				Swal.fire({
					icon: "success",
					title: msg,
					showConfirmButton: false,
					timer: 1500
				});
			});
		}
	});

</script>