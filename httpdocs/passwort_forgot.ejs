<!doctype html>
<html class="no-js layout__7" lang="zxx">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Laaver</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico">
    <!-- Place favicon.ico in the root directory -->

        <!-- CSS here -->
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/animate.min.css">
        <link rel="stylesheet" href="css/magnific-popup.css">
        <link rel="stylesheet" href="css/all.min.css">
        <link rel="stylesheet" href="css/futura-std-4.css">
        <link rel="stylesheet" href="css/slick.css">
        <link rel="stylesheet" href="css/style.css">

		<script src="javascript/header_footer.js "></script>
</head>


<body>


    <main class="main_wrapper body__overlay overflow__hidden">

		<%- include('./header.ejs') %>   

		<!-- login__section__start -->
		<section class="section-b-space pt-0 login-bg-img">
		  <div class="custom-container container login-page"> 
			<div class="row align-items-center"> 
			  <div class="col-xxl-7 col-lg-6 col-md-12 mx-auto">
				<div class="login-img"> <img class="img-fluid" src="images/forgot.png" alt=""></div><br/>
			  </div>
			  <div class="col-xxl-4 col-lg-6 col-md-12 mx-auto">
			  <div class="log-in-box">
				<div class="log-in-title">
				  <h4 id="forgot_title">Passwort vergessen</h4>
				</div>
				<div class="login-box">
				  <form class="row g-4">
					<div class="col-12">
					  <div class="form-floating theme-form-floating log-in-form">
						<input type="email" class="form-control" id="email" placeholder="Email Address">
						<label for="email" id="forgot_label_email">Email Adresse</label>
					  </div>
					</div>

					<div class="col-12">
					  <button class="btn login btn_black sm" type="button" id="forgot_button_submit" style="border: 1px solid #212529;" onclick="checkForgotInfo()">Passwort vergessen</button>
					</div>
				  </form>
				</div>
			  </div>
			</div>
			</div>
		  </div>
		</section>	
		
		<!-- Hinweisen Modal Start -->
		<div class="modal fade theme-modal deal-modal" id="HinweisenModalFade" tabindex="-1">
			<div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
				<div class="modal-content">
					<div class="modal-header">
						<div>
							<h5 class="modal-title w-100" id="HinweisenModalTitle"></h5>
						</div>
						<button type="button" class="btn-close" data-bs-dismiss="modal" id="HinweisenModalButton1"></button>
					</div>
					<div class="modal-body">
						<div id="HinweisenModalInhalt" style="font-size:16px;margin:5px 5px 20px 5px;"></div>					
						<div>
							<button class="btn btn-md fw-bold mt-md-4 mt-2 mend-auto" id="HinweisenModalButton2" style="width:100%;" data-bs-dismiss="modal">
								<span id="modal_button_close">Schließen</span>
							</button>
						</div>
					</div>

				</div>
			</div>
		</div>
		<!-- Hinweisen Modal End -->



	    <%- include('./footer.ejs') %>     

	</main>


    <!-- JS here -->
    <script src="js/vendor/modernizr-3.5.0.min.js "></script>
    <script src="js/vendor/jquery-3.6.0.min.js "></script>
	
	<script>		
	function checkForgotInfo(){
		var email = escape(escape(document.getElementById("email").value));
		var EmailCode = generateRandomString(32);
		
		var bool=true;
		if(!validateEmail(email)){
			alert("Email Format ist falsch!"); bool=false;
		}else if(email==""){
			alert("Email Adresse kann nicht leer sein!"); bool=false;
		}
		
		if(bool){
			$.ajax({
				type: "POST",
				url: "/frontend_passwort_forgot_1",
				contentType: 'application/x-www-form-urlencoded',
				data: {
					email: email,
					EmailCode: EmailCode
				},
				cache: false,
				success: function (response) {
					if(response==1){
						alert("Email Adresse existieren nicht!");
					 }else{
						sendPasswortForgotEmail(email,EmailCode); 
					 }
				},
				error: function (xhr, status, error) {
					console.error("AJAX Fehler:", status, error);
				}
			});
		}
	}

	function sendPasswortForgotEmail(Email,EmailCode){	
		$.ajax({
		  type: "POST",
			 url: "/sendPasswortForgotEmail",
			 data:{
				 "Email":unescape(Email),
				 "EmailCode":EmailCode,
			 },
			 cache: false,
			 success: function (response) {
				document.getElementById("HinweisenModalInhalt").innerHTML = "Deine Passwort-Reset-E-Mail wurde an dein Postfach gesendet.<br/>Bitte überprüfe dein Postfach.";
				document.getElementById("HinweisenModalTitle").style.color = "#0da487";
				document.getElementById("HinweisenModalButton1").style.backgroundColor = "#0da487";
				document.getElementById("HinweisenModalButton2").style.backgroundColor = "#0da487";			
				$('#HinweisenModalFade').modal('show');	
				
				setTimeout(function(){window.location.href="/";},2000);
				
			 },
			 error: function (response) {
				console.log(response);
			 }
	   });
	}

	function validateEmail(email) {
	  var pattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
	  return pattern.test(email);
	}

	function generateRandomString(length) {
	  var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
	  var result = '';
	  var charactersLength = characters.length;
	  
	  for (var i = 0; i < length; i++) {
		result += characters.charAt(Math.floor(Math.random() * charactersLength));
	  }
	  
	  return result;
	}
	
	
	languageInnerHTMLArr.push(new languageObj("forgot_title", "Forgot Password", "Passwort vergessen", "Mot de passe oublié", "忘记密码"));
	languageInnerHTMLArr.push(new languageObj("forgot_label_email", "Email Address", "Email Adresse", "Adresse e-mail", "电子邮件地址"));
	languageInnerHTMLArr.push(new languageObj("forgot_button_submit", "Forgot Password", "Passwort vergessen", "Mot de passe oublié", "忘记密码"));

	languagePlaceholderArr.push(new languageObj("email", "Email Address", "Email Adresse", "Adresse e-mail", "电子邮件地址"));

	</script>		
	
    <script src="js/popper.min.js "></script>
    <script src="js/bootstrap.min.js "></script>
    <script src="js/isotope.pkgd.min.js "></script>
    <script src="js/one-page-nav-min.js "></script>
    <script src="js/slick.min.js "></script>
    <script src="js/jquery.meanmenu.min.js "></script>
    <script src="js/ajax-form.js "></script>
    <script src="js/wow.min.js "></script>
    <script src="js/jquery.scrollUp.min.js "></script>
    <script src="js/imagesloaded.pkgd.min.js "></script>
    <script src="js/jquery.magnific-popup.min.js "></script>
    <script src="js/waypoints.min.js "></script>
    <script src="js/jquery.counterup.min.js "></script>
    <script src="js/fontawesome.min.js "></script>
    <script src="js/plugins.js "></script>
    <script src="js/main.js "></script>
	

</body>

</html>