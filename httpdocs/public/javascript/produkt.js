var ProduktIDX=0;if(String(GetQueryString("prIDX"))!="" && String(GetQueryString("prIDX"))!="null" && String(GetQueryString("prIDX"))!="undefined") ProduktIDX = parseInt(GetQueryString("prIDX"));function GetQueryString(string){   var reg = new RegExp('(^|&)'+ string +'=([^&]*)(&|$)');   var r = window.location.search.substr(1).match(reg);   if(r!=null)return unescape(r[2]); return null;}var ProduktArr = new Array(),oneProdukt = "",ProduktEinzelArr = new Array(), oneProduktEinzel = "", ProduktAttributeArr = new Array(), BildArr = new Array(), PdfArr = new Array();function initGUI(){	if(ProduktIDX==0) window.location.href = "/";	else{		searchProdukt();	}}function searchProdukt(){	ProduktArr = new Array();	oneProdukt = "";		$.ajax({		type: "POST",		url: "/frontend_produkt_1",		contentType: 'application/x-www-form-urlencoded',		async: false, 		data: {			prIDX: ProduktIDX		},		success: function (response) {			if (response.results && Array.isArray(response.results)) {                response.results.forEach(function (item) {					var obj = {};					for (var key in item) {						var val = item[key];						// 1. BIT Á±ªÂûãÂ≠óÊÆµÔºàBufferÔºâ						if (val && typeof val === 'object' && val.type === 'Buffer' && Array.isArray(val.data)) {							obj[key] = val.data[0] ? 1 : 0;						}						// 2. ÂåÖÂê´ "Datum" ÁöÑÂ≠óÊÆµÔºàÊó•ÊúüÔºâ						else if (key.includes("Datum")) {							if (val === null || val === undefined) {								obj[key] = "";							} else {								try {									obj[key] = val.toString().substring(0, 10);								} catch (e) {									obj[key] = "";								}							}						}						// 3. ÂÖ∂‰ªñÂ≠óÊÆµÔºöÂ≠óÁ¨¶‰∏≤ËøõË°å unescapeÔºåÂÖ∂‰ªñÁõ¥Êé•ËµãÂÄº						else {							if (typeof val === "string") {								obj[key] = unescape(val);							} else {								obj[key] = val;							}						}					}					ProduktArr.push(obj);				});								if(ProduktArr.length>0){					oneProdukt = ProduktArr[0];					searchProduktEinzel();				}				            } else {                console.error("response.results ‰∏çÊòØ‰∏Ä‰∏™Êï∞ÁªÑÊàñ‰∏çÂ≠òÂú®");            }		}	});}function searchProduktEinzel(){	$.ajax({		type: "POST",		url: "/frontend_produkt_2",		contentType: 'application/x-www-form-urlencoded',		async: false, 		data: {			prIDX: ProduktIDX		},		success: function (response) {			if (response.results && Array.isArray(response.results)) {				const [einzelArr, attributArr, bildArr, pdfArr] = response.results;				ProduktEinzelArr = [];				ProduktAttributeArr = [];				BildArr = [];				PdfArr = [];				// Â§ÑÁêÜ Produkt_Einzel				einzelArr.forEach(function (item) {					var obj = {};					for (var key in item) {						var val = item[key];						if (val && typeof val === 'object' && val.type === 'Buffer' && Array.isArray(val.data)) {							obj[key] = val.data[0] ? 1 : 0;						} else if (key.includes("Datum")) {							obj[key] = val ? val.toString().substring(0, 10) : "";						} else {							obj[key] = (typeof val === "string") ? unescape(val) : val;						}					}					ProduktEinzelArr.push(obj);				});				// Â§ÑÁêÜ Produkt_Attribute				attributArr.forEach(function (item) {					var obj = {};					for (var key in item) {						var val = item[key];						if (val && typeof val === 'object' && val.type === 'Buffer' && Array.isArray(val.data)) {							obj[key] = val.data[0] ? 1 : 0;						} else if (key.includes("Datum")) {							obj[key] = val ? val.toString().substring(0, 10) : "";						} else {							obj[key] = (typeof val === "string") ? unescape(val) : val;						}					}					ProduktAttributeArr.push(obj);				});				// Â§ÑÁêÜ Produkt_Bild				bildArr.forEach(function (item) {					var obj = {};					for (var key in item) {						var val = item[key];						if (val && typeof val === 'object' && val.type === 'Buffer' && Array.isArray(val.data)) {							obj[key] = val.data[0] ? 1 : 0;						} else if (key.includes("Datum")) {							obj[key] = val ? val.toString().substring(0, 10) : "";						} else {							obj[key] = (typeof val === "string") ? unescape(val) : val;						}					}					BildArr.push(obj);				});							// Â§ÑÁêÜ PDF				pdfArr.forEach(function (item) {					var obj = {};					for (var key in item) {						var val = item[key];						if (val && typeof val === 'object' && val.type === 'Buffer' && Array.isArray(val.data)) {							obj[key] = val.data[0] ? 1 : 0;						} else if (key.includes("Datum")) {							obj[key] = val ? val.toString().substring(0, 10) : "";						} else {							obj[key] = (typeof val === "string") ? unescape(val) : val;						}					}					PdfArr.push(obj);				});										}						showProduktModal();		}	});	}function showProduktModal(){	var txt="";	switch (lang) {		case "en":			document.getElementById("ProduktnameDiv").innerHTML = unescape(oneProdukt.ProduktString4).replace(/%22/ig," ");			document.getElementById("ProduktInfoDiv").innerHTML = unescape(oneProdukt.ProduktString23.replace(/%0A/ig,"<br/>"));				ProduktDescription = unescape(oneProdukt.ProduktString24.replace(/%0A/ig,"<br/>"));				break;		case "de":			document.getElementById("ProduktnameDiv").innerHTML = unescape(oneProdukt.ProduktString2).replace(/%22/ig," ");			document.getElementById("ProduktInfoDiv").innerHTML = unescape(oneProdukt.ProduktString21.replace(/%0A/ig,"<br/>"));				ProduktDescription = unescape(oneProdukt.ProduktString22.replace(/%0A/ig,"<br/>"));			break;		case "fr":			document.getElementById("ProduktnameDiv").innerHTML = unescape(oneProdukt.ProduktString5).replace(/%22/ig," ");			document.getElementById("ProduktInfoDiv").innerHTML = unescape(oneProdukt.ProduktString25.replace(/%0A/ig,"<br/>"));				ProduktDescription = unescape(oneProdukt.ProduktString26.replace(/%0A/ig,"<br/>"));			break;		case "cn":			document.getElementById("ProduktnameDiv").innerHTML = unescape(oneProdukt.ProduktString3).replace(/%22/ig," ");			document.getElementById("ProduktInfoDiv").innerHTML = unescape(oneProdukt.ProduktString27.replace(/%0A/ig,"<br/>"));			ProduktDescription = unescape(oneProdukt.ProduktString28.replace(/%0A/ig,"<br/>"));						break;		default: 			document.getElementById("ProduktnameDiv").innerHTML = unescape(oneProdukt.ProduktString4).replace(/%22/ig," ");			document.getElementById("ProduktInfoDiv").innerHTML = unescape(oneProdukt.ProduktString23.replace(/%0A/ig,"<br/>"));				ProduktDescription = unescape(oneProdukt.ProduktString24.replace(/%0A/ig,"<br/>"));			break;	}					if(ProduktEinzelArr.length==0){		document.getElementById("ProduktFloat1Div").innerHTML = FCommaEUR(oneProdukt.ProduktFloat1)+"&nbsp;‚Ç¨";			if(parseFloat(oneProdukt.ProduktFloat3)>0) document.getElementById("ProduktFloat3Div").innerHTML = FCommaEUR(oneProdukt.ProduktFloat1)+"&nbsp;‚Ç¨";		}		var txt1 = "",txt2 = "",txt3 = "";		if(String(oneProdukt.ProduktString13)!=""){			txt1 += "<div class='featurearea__single__big__img'><img src='https://intranet.laaver.com/file/product/"+String(oneProdukt.ProduktString13)+"'></div>";		txt2 += "<div class='featurearea__single__thumb__img'><img src='https://intranet.laaver.com/file/product/"+String(oneProdukt.ProduktString13)+"'></div>";	}			for(var i=0; i<BildArr.length; i++){		if(BildArr[i].ProduktBildString10=='Banner'){				txt1 += "<div class='featurearea__single__big__img'><img src='https://intranet.laaver.com/file/product/"+String(BildArr[i].ProduktBildString11)+"'></div>";			txt2 += "<div class='featurearea__single__thumb__img'><img src='https://intranet.laaver.com/file/product/"+String(BildArr[i].ProduktBildString11)+"'></div>";		}	}	document.getElementById("BildBannerDiv1").innerHTML = txt1;	document.getElementById("BildBannerDiv2").innerHTML = txt2;			txt="";	txt += unescape(ProduktDescription);	for(var i=0; i<BildArr.length; i++){		if(BildArr[i].ProduktBildString10=="Detail"){			txt += "<div style='margin-top:15px;'>"+					"<img src='https://intranet.laaver.com/file/product/"+String(BildArr[i].ProduktBildString11)+"' style='width:100%;' class='img-fluid blur-up lazyload' alt=''>"+					"</div>";		}	}		document.getElementById("ProduktDescriptionDiv").innerHTML = txt;		for (var i = 0; i < PdfArr.length; i++) {			txt3 +=  "<div style='padding-bottom: 10px;'>"+				"<a href='https://intranet.laaver.com/file/pdf/" + PdfArr[i].Filename + "' style='display:inline-block;padding: 6px 20px;border: 1px solid #3699FF;border-radius: 5px;color: #3699FF;font-size: 16px;' target='_blank'>"+unescape(PdfArr[i].Dateiname)+"</a></div>";					}	document.getElementById('DownloadDiv').innerHTML = txt3;		if(ProduktEinzelArr.length>0) showAttributeAndPreis();}var SelectedAttributeIDs = new Array();function showAttributeAndPreis() {    ProduktAttributeArr.sort(compare("ProduktAttributeString1"));    let txt = "", tempName = "", firstInGroup = false;    SelectedAttributeIDs = [];    for (let i = 0; i < ProduktAttributeArr.length; i++) {        const attrID = Number(ProduktAttributeArr[i].prIDX); // üëà ËΩ¨‰∏∫Êï∞Â≠ó        if (tempName !== ProduktAttributeArr[i].ProduktAttributeString1) {            if (i > 0) txt += "</ul></div>";            txt += "<div class='single__product__swatch single__product__size'>";						switch (lang) {				case "en":					txt += "<span class='header'>" + unescape(ProduktAttributeArr[i].ProduktAttributeString4) + "</span><ul>";					break;				case "de":					txt += "<span class='header'>" + unescape(ProduktAttributeArr[i].ProduktAttributeString1) + "</span><ul>";					break;				case "fr":					txt += "<span class='header'>" + unescape(ProduktAttributeArr[i].ProduktAttributeString6) + "</span><ul>";					break;				case "cn":					txt += "<span class='header'>" + unescape(ProduktAttributeArr[i].ProduktAttributeString8) + "</span><ul>";					break;				default: 					txt += "<span class='header'>" + unescape(ProduktAttributeArr[i].ProduktAttributeString4) + "</span><ul>";					break;			}			                        tempName = ProduktAttributeArr[i].ProduktAttributeString1;            firstInGroup = true;        }        let isSelected = false;        if (firstInGroup) {            SelectedAttributeIDs.push(attrID); // ‰øùËØÅÊòØÊï∞Â≠ó            isSelected = true;        }				let tempWidth = "40", tempColor="", style="";		if(unescape(unescape(ProduktAttributeArr[i].ProduktAttributeString4)).toLowerCase()=="color"){				tempWidth = "40";			if(unescape(ProduktAttributeArr[i].ProduktAttributeString5).toLowerCase()=="black") tempColor = "#000";			else if(unescape(ProduktAttributeArr[i].ProduktAttributeString5).toLowerCase()=="white") tempColor = "#FFF";						style = "display:inline-block;padding:2px 10px;margin:4px;border:1px solid;border-radius:6px;text-decoration:none;cursor:pointer;font-size:16px;text-transform: none;height:auto;width:"+tempWidth+"px;";			style += isSelected 				? "background-color:"+tempColor+";color:"+tempColor+";border: 4px solid #02a9f7;"				: "background-color:"+tempColor+";color:"+tempColor+";border: 4px solid #ccc;";				txt += "<li>" +               "<a onclick='onClickPreisFromAttributeColor(this)' " +               "style='" + style + "' " +               "data-idx='" + attrID + "' " +  // ‰ªçÊòØÂ≠óÁ¨¶‰∏≤Â±ûÊÄßÔºåËß£ÊûêÊó∂ÂÜçËΩ¨               "data-group='" + encodeURIComponent(ProduktAttributeArr[i].ProduktAttributeString1) + "'>";						}else{			tempWidth = parseInt(parseInt(unescape(ProduktAttributeArr[i].ProduktAttributeString1).length)*20);							style = "display:inline-block;padding:2px 10px;margin:4px;border:1px solid;border-radius:6px;text-decoration:none;cursor:pointer;font-size:16px;text-transform: none;height:auto;width:"+tempWidth+"px;";			style += isSelected				? "background-color:#02a9f7;color:white;border-color:#02a9f7;"				: "background-color:#f0f0f0;color:#333;border-color:#ccc;";						txt += "<li>" +               "<a onclick='onClickPreisFromAttribute(this)' " +               "style='" + style + "' " +               "data-idx='" + attrID + "' " +  // ‰ªçÊòØÂ≠óÁ¨¶‰∏≤Â±ûÊÄßÔºåËß£ÊûêÊó∂ÂÜçËΩ¨               "data-group='" + encodeURIComponent(ProduktAttributeArr[i].ProduktAttributeString1) + "'>";		}						switch (lang) {			case "en":				if(unescape(unescape(ProduktAttributeArr[i].ProduktAttributeString4)).toLowerCase()=="color") txt += "&nbsp;</a></li>";				else txt += unescape(ProduktAttributeArr[i].ProduktAttributeString5) + "</a></li>";				break;			case "de":				if(unescape(unescape(ProduktAttributeArr[i].ProduktAttributeString4)).toLowerCase()=="color") txt += "&nbsp;</a></li>";				else txt += unescape(ProduktAttributeArr[i].ProduktAttributeString2) + "</a></li>";				break;			case "fr":				if(unescape(unescape(ProduktAttributeArr[i].ProduktAttributeString4)).toLowerCase()=="color") txt += "&nbsp;</a></li>";				else txt += unescape(ProduktAttributeArr[i].ProduktAttributeString7) + "</a></li>";				break;			case "cn":				if(unescape(unescape(ProduktAttributeArr[i].ProduktAttributeString4)).toLowerCase()=="color") txt += "&nbsp;</a></li>";				else txt += unescape(ProduktAttributeArr[i].ProduktAttributeString9) + "</a></li>";				break;			default: 				if(unescape(unescape(ProduktAttributeArr[i].ProduktAttributeString4)).toLowerCase()=="color") txt += "&nbsp;</a></li>";				else txt += unescape(ProduktAttributeArr[i].ProduktAttributeString5) + "</a></li>";				break;		}	                          firstInGroup = false;    }    txt += "</ul></div>";		if(ProduktAttributeArr.length <= 1) document.getElementById("ProduktAttributeDiv").style.display = "none";	else document.getElementById("ProduktAttributeDiv").style.display = "block";    document.getElementById("ProduktAttributeDiv").innerHTML = txt;    setPreisFromAttribute();}function onClickPreisFromAttributeColor(el) {    const group = el.getAttribute("data-group");    const idx = Number(el.getAttribute("data-idx")); // üëà ËΩ¨‰∏∫Êï∞Â≠ó    // ÁßªÈô§ÊóßÁöÑ    for (let i = 0; i < ProduktAttributeArr.length; i++) {        if (ProduktAttributeArr[i].ProduktAttributeString1 === decodeURIComponent(group)) {            const oldID = Number(ProduktAttributeArr[i].prIDX);            const index = SelectedAttributeIDs.indexOf(oldID);            if (index !== -1) {                SelectedAttributeIDs.splice(index, 1);            }        }    }    // Ê∑ªÂä†Êñ∞ÂÄº    SelectedAttributeIDs.push(idx);    // Êõ¥Êñ∞Ê†∑Âºè    document.querySelectorAll('a[data-group="' + group + '"]').forEach(a => {        a.style.border = '4px solid #ccc';    });	el.style.border = '4px solid #02a9f7';	    // Êõ¥Êñ∞‰ª∑Ê†º    setPreisFromAttribute();}function onClickPreisFromAttribute(el) {    const group = el.getAttribute("data-group");    const idx = Number(el.getAttribute("data-idx")); // üëà ËΩ¨‰∏∫Êï∞Â≠ó    // ÁßªÈô§ÊóßÁöÑ    for (let i = 0; i < ProduktAttributeArr.length; i++) {        if (ProduktAttributeArr[i].ProduktAttributeString1 === decodeURIComponent(group)) {            const oldID = Number(ProduktAttributeArr[i].prIDX);            const index = SelectedAttributeIDs.indexOf(oldID);            if (index !== -1) {                SelectedAttributeIDs.splice(index, 1);            }        }    }    // Ê∑ªÂä†Êñ∞ÂÄº    SelectedAttributeIDs.push(idx);    // Êõ¥Êñ∞Ê†∑Âºè    document.querySelectorAll('a[data-group="' + group + '"]').forEach(a => {        a.style.backgroundColor = '#f0f0f0';        a.style.color = '#333';        a.style.borderColor = '#ccc';    });    el.style.backgroundColor = '#02a9f7';    el.style.color = 'white';    el.style.borderColor = '#02a9f7';    // Êõ¥Êñ∞‰ª∑Ê†º    setPreisFromAttribute();}function setPreisFromAttribute() {    oneProduktEinzel = "";    document.getElementById("ProduktFloat1Div").innerHTML = "";    document.getElementById("ProduktFloat2Div").innerHTML = "";    for (let i = 0; i < ProduktEinzelArr.length; i++) {        const str = ProduktEinzelArr[i].ProduktEinzelString1; // Â¶Ç "101,202"        if (areAllNumbersInString(str, SelectedAttributeIDs)) {            if (ProduktEinzelArr[i].ProduktEinzelFloat2>0 && ProduktEinzelArr[i].ProduktEinzelInt2>0) {                document.getElementById("ProduktFloat2Div").innerHTML = FCommaEUR(ProduktEinzelArr[i].ProduktEinzelFloat1) + "&nbsp;‚Ç¨";					document.getElementById("ProduktFloat1Div").innerHTML = FCommaEUR(ProduktEinzelArr[i].ProduktEinzelFloat2) + "&nbsp;‚Ç¨";					document.getElementById("ProduktInt1Div").innerHTML = "-" + ProduktEinzelArr[i].ProduktEinzelInt2 + "%";	            }else{				document.getElementById("ProduktFloat2Div").innerHTML = "";				document.getElementById("ProduktFloat1Div").innerHTML = FCommaEUR(ProduktEinzelArr[i].ProduktEinzelFloat1) + "&nbsp;‚Ç¨";					document.getElementById("ProduktInt1Div").innerHTML = "";				}									if(ProduktEinzelArr[i].lagerCount==0){				document.getElementById("VerfuegbarDiv").style.display = "block";				document.getElementById("saveToCartButton").setAttribute("disabled","disabled");			}else{				document.getElementById("VerfuegbarDiv").style.display = "none";				document.getElementById("saveToCartButton").removeAttribute("disabled");			}            oneProduktEinzel = ProduktEinzelArr[i];            break;        }    }}function areAllNumbersInString(str, arr) {    // Â∞ÜÂ≠óÁ¨¶‰∏≤ÊãÜÂàÜ‰∏∫Êï∞Â≠óÊï∞ÁªÑ    var numbersInString = str.split(",").map(Number);       // Ê£ÄÊü•Êï∞ÁªÑ‰∏≠ÁöÑÊØè‰∏™Êï∞Â≠óÊòØÂê¶ÈÉΩÂú®Â≠óÁ¨¶‰∏≤‰∏≠    return arr.every(function(num) {        return numbersInString.includes(num);    });}function saveToCart(){	document.getElementById("saveToCartButton").style.display = "none";	var Menge = parseInt(document.getElementById("WarenkorbProduktMengeInput").value);		var EinzelIdx = 0;	for(var i=0; i<ProduktEinzelArr.length; i++){		if(areAllNumbersInString(ProduktEinzelArr[i].ProduktEinzelString1,SelectedAttributeIDs)){			EinzelIdx = ProduktEinzelArr[i].prIDX;			break;		}	}     if(Menge>0){		//ÂÖàÂà§Êñ≠ÊòØÂê¶ÊúâÈáçÂ§ç prIDXÔºõÂ¶ÇÊûúÊúâÈáçÂ§çÔºåËøîÂõûÈáçÂ§çÈ°πÁöÑ menge ÂÄºÔºõÂêåÊó∂ÊääÈáçÂ§çÁöÑÈÇ£‰∏ÄÈ°π‰ªéÂéüÊï∞ÁªÑ‰∏≠Âà†Èô§ÊéâÔºõÂ¶ÇÊûúÊ≤°ÊúâÈáçÂ§çÔºåËøîÂõû 0		Menge += getDuplicateMenge(oneProdukt.prIDX, EinzelIdx);				if(UserID==0 && VorlaufigUserID!=""){			var tempArr = [oneProdukt.prIDX,oneProduktEinzel.prIDX,Menge,""];			VorlaufigKaufwagenArr.push(tempArr);			var storage = window.sessionStorage;								storage.setItem('VorlaufigKaufwagenArr',JSON.stringify(VorlaufigKaufwagenArr));						saveToCartSuccess();		}else{		    $.ajax({				type: "POST",				url: "/produkt_save_1",				contentType: 'application/x-www-form-urlencoded',				data: {					oneProdukt: JSON.stringify(oneProdukt),					oneProduktEinzel: JSON.stringify(oneProduktEinzel),					Menge: Menge,					UserID: UserID				},				cache: false,				success: function (response) {					saveToCartSuccess();				},				error: function (response) {					console.log(response);				}			});		}	   }}function saveToCartSuccess(){	/****	switch (lang) {		case "en":			document.getElementById("WarenkorbProduktnameDiv").innerHTML = unescape(oneProdukt.ProduktString4.replace(/%22/ig," "));			break;		case "de":			document.getElementById("WarenkorbProduktnameDiv").innerHTML = unescape(oneProdukt.ProduktString2.replace(/%22/ig," "));			break;		case "fr":			document.getElementById("WarenkorbProduktnameDiv").innerHTML = unescape(oneProdukt.ProduktString5.replace(/%22/ig," "));			break;		case "cn":			document.getElementById("WarenkorbProduktnameDiv").innerHTML = unescape(oneProdukt.ProduktString3.replace(/%22/ig," "));			break;		default: 			document.getElementById("WarenkorbProduktnameDiv").innerHTML = unescape(oneProdukt.ProduktString4.replace(/%22/ig," "));			break;	}		document.getElementById("WarenkorbModalEinzelBildDiv").innerHTML = "<img src='https://intranet.laaver.com/file/product/"+oneProdukt.ProduktString13+"' class='img-fluid lazyload' style='width:100%;' alt=''>";	document.getElementById("WarenkorbProduktMengeDiv").innerHTML = parseInt(Menge);	if(oneProdukt.ProduktFloat3==0) document.getElementById("WarenkorbProduktPreisDiv").innerHTML = FCommaEUR(oneProdukt.ProduktFloat1)+"<span style='font-size:16px;'>&nbsp;‚Ç¨</span>";		else document.getElementById("WarenkorbProduktPreisDiv").innerHTML = FCommaEUR(oneProdukt.ProduktFloat3)+"<span style='font-size:16px;'>&nbsp;‚Ç¨</span>";			$('#WarenkorbModal').modal('show');		****/			setTimeout(function(){window.location.href="/einkaufswagen";},2000);}function getDuplicateMenge(prIDX, EinzelIdx) {     for (let i = 0; i < VorlaufigKaufwagenArr.length; i++) {        const item = VorlaufigKaufwagenArr[i];        if (item.prIDX === prIDX && item.EinzelIdx === EinzelIdx) {            const menge = parseInt(item.Menge) || 0;            // Âà†Èô§ËøôÈ°π            VorlaufigKaufwagenArr.splice(i, 1);            return menge;        }    }    return 0;}