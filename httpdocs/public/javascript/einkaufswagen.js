var oneKunden = "";function GetQueryString(string){   var reg = new RegExp('(^|&)'+ string +'=([^&]*)(&|$)');   var r = window.location.search.substr(1).match(reg);   if(r!=null)return unescape(r[2]); return null;}function initGUI(){	if(UserID==0){		if(VorlaufigUserID!="" && VorlaufigKaufwagenArr.length>0) searchVorlaufigEinkaufswagen();	}else{		searchKunden();	}}function searchKunden(){	oneKunden = "";	$.ajax({		type: "POST",		url: "/frontend_einkaufswagen_1",		contentType: 'application/x-www-form-urlencoded',		async: false, 		data: {			UserID: UserID		},		success: function (response) {			if (response.results && Array.isArray(response.results)) {                response.results.forEach(function (item) {					var obj = {};					for (var key in item) {						var val = item[key];						// 1. BIT 类型字段（Buffer）						if (val && typeof val === 'object' && val.type === 'Buffer' && Array.isArray(val.data)) {							obj[key] = val.data[0] ? 1 : 0;						}						// 2. 包含 "Datum" 的字段（日期）						else if (key.includes("Datum")) {							if (val === null || val === undefined) {								obj[key] = "";							} else {								try {									obj[key] = val.toString().substring(0, 10);								} catch (e) {									obj[key] = "";								}							}						}						// 3. 其他字段：字符串进行 unescape，其他直接赋值						else {							if (typeof val === "string") {								obj[key] = unescape(val);							} else {								obj[key] = val;							}						}					}					oneKunden = obj;				});							            } else {                console.error("response.results 不是一个数组或不存在");            }		}	});	searchEinkaufswagen();}var EinkaufswagenArr = new Array();function searchEinkaufswagen(){	EinkaufswagenArr = new Array();		$.ajax({		type: "POST",		url: "/frontend_einkaufswagen_2",		contentType: 'application/x-www-form-urlencoded',		async: false, 		data: {			UserID: UserID		},		success: function (response) {			if (response.results && Array.isArray(response.results)) {                response.results.forEach(function (item) {					var obj = {};					for (var key in item) {						var val = item[key];						// 1. BIT 类型字段（Buffer）						if (val && typeof val === 'object' && val.type === 'Buffer' && Array.isArray(val.data)) {							obj[key] = val.data[0] ? 1 : 0;						}						// 2. 包含 "Datum" 的字段（日期）						else if (key.includes("Datum")) {							if (val === null || val === undefined) {								obj[key] = "";							} else {								try {									obj[key] = val.toString().substring(0, 10);								} catch (e) {									obj[key] = "";								}							}						}						// 3. 其他字段：字符串进行 unescape，其他直接赋值						else {							if (typeof val === "string") {								obj[key] = unescape(val);							} else {								obj[key] = val;							}						}					}					EinkaufswagenArr.push(obj);				});				showEinkaufswagen();				            } else {                console.error("response.results 不是一个数组或不存在");            }		}	});}function searchVorlaufigEinkaufswagen(){	EinkaufswagenArr = new Array();		$.ajax({		type: "POST",		url: "/frontend_einkaufswagen_3",		contentType: 'application/x-www-form-urlencoded',		async: false, 		data: {			"VorlaufigKaufwagenArr":JSON.stringify(VorlaufigKaufwagenArr),		},		success: function (response) {			if (response.results && Array.isArray(response.results)) {                response.results.forEach(function (item) {					var obj = {};					for (var key in item) {						var val = item[key];						// 1. BIT 类型字段（Buffer）						if (val && typeof val === 'object' && val.type === 'Buffer' && Array.isArray(val.data)) {							obj[key] = val.data[0] ? 1 : 0;						}						// 2. 包含 "Datum" 的字段（日期）						else if (key.includes("Datum")) {							if (val === null || val === undefined) {								obj[key] = "";							} else {								try {									obj[key] = val.toString().substring(0, 10);								} catch (e) {									obj[key] = "";								}							}						}						// 3. 其他字段：字符串进行 unescape，其他直接赋值						else {							if (typeof val === "string") {								obj[key] = unescape(val);							} else {								obj[key] = val;							}						}					}					EinkaufswagenArr.push(obj);				});				showEinkaufswagen();				            } else {                console.error("response.results 不是一个数组或不存在");            }		}	});}function showEinkaufswagen(){	var txt = "", Produktname = "", AngebotPreis = 0;			for(var i=0; i<EinkaufswagenArr.length; i++){		AngebotPreis = parseFloat(EinkaufswagenArr[i].ProduktEinzelFloat1);		if(EinkaufswagenArr[i].ProduktEinzelFloat2>0) AngebotPreis = parseFloat(EinkaufswagenArr[i].ProduktEinzelFloat2);		Produktname = "";			switch (lang) {			case "en":				Produktname = unescape(EinkaufswagenArr[i].EinkaufswagenString4).replace(/%22/ig," ");				break;			case "de":				Produktname = unescape(EinkaufswagenArr[i].EinkaufswagenString2).replace(/%22/ig," ");				break;			case "fr":				Produktname = unescape(EinkaufswagenArr[i].EinkaufswagenString5).replace(/%22/ig," ");				break;			case "cn":				Produktname = unescape(EinkaufswagenArr[i].EinkaufswagenString3).replace(/%22/ig," ");					break;			default: 				Produktname = unescape(EinkaufswagenArr[i].EinkaufswagenString4).replace(/%22/ig," ");				break;		}				txt += "<tr><td class='cartarea__product__thumbnail'>"+				"<a href='/produkt?prIDX="+EinkaufswagenArr[i].Produkt_prIDX+"'>"+				"<img src='https://intranet.laaver.com/file/product/"+unescape(EinkaufswagenArr[i].ProduktString13)+"' alt='cart'>"+				"</a></td>"+				"<td class='cartarea__product__name'>"+				"<a href='/produkt?prIDX="+EinkaufswagenArr[i].Produkt_prIDX+"'>"+Produktname+"</a>";						if(unescape(EinkaufswagenArr[i].AttributeResult) != "Standard: Standard") txt += "<br/>"+unescape(EinkaufswagenArr[i].AttributeResult);						txt += "</td>"+				"<td class='cartarea__product__price__cart'><span class='amount'>"+String(FCommaEUR(AngebotPreis))+"&nbsp;€</span></td>"+				"<td class='cartarea__product__quantity'>"+				"<div class='featurearea__quantity'>"+				"<div class='qty-container'>"+				"<button class='qty-btn-minus btn-qty' type='button' onclick='setProduktMengeA(1,"+i+","+AngebotPreis+")'><i class='fa fa-minus' style='font-size:10px;'></i></button>"+				"<input type='text' name='qty' class='input-qty'  id='ProduktMengeSpanA"+i+"' value='"+parseInt(EinkaufswagenArr[i].EinkaufswagenInt3)+"' disabled='disabled'>"+				"<button class='qty-btn-plus btn-qty' type='button' onclick='setProduktMengeA(2,"+i+","+AngebotPreis+")'><i class='fa fa-plus' style='font-size:10px;'></i></button>"+				"</div></div></td>"+				"<td class='cartarea__product__subtotal' id='ZwischensummeDiv"+i+"'>"+FCommaEUR(parseFloat(AngebotPreis*parseInt(EinkaufswagenArr[i].EinkaufswagenInt3)))+"&nbsp;€</td>"+				"<td class='cartarea__product__remove'>"+				"<a href='javascript:DeleteFromCart("+i+")' style='width:100%;'>"+				"<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><title>Trash</title><path d='M112 112l20 320c.95 18.49 14.4 32 32 32h184c17.67 0 30.87-13.51 32-32l20-320' fill='none' stroke='currentColor' stroke-linecap='round' stroke-linejoin='round' stroke-width='32'/><path stroke='currentColor' stroke-linecap='round' stroke-miterlimit='10' stroke-width='32' d='M80 112h352'/><path d='M192 112V72h0a23.93 23.93 0 0124-24h80a23.93 23.93 0 0124 24h0v40M256 176v224M184 176l8 224M328 176l-8 224' fill='none' stroke='currentColor' stroke-linecap='round' stroke-linejoin='round' stroke-width='32'/></svg></a>"+				"</td></tr>";	}		document.getElementById("mainTableDiv").innerHTML = txt;		setTotalPreis();}function setTotalPreis(){	var tempSumme=0;	for(var i=0; i<EinkaufswagenArr.length; i++){			AngebotPreis = parseFloat(EinkaufswagenArr[i].ProduktEinzelFloat1);		if(EinkaufswagenArr[i].ProduktEinzelFloat2>0) AngebotPreis = parseFloat(EinkaufswagenArr[i].ProduktEinzelFloat2);		tempSumme += parseFloat(AngebotPreis*EinkaufswagenArr[i].EinkaufswagenInt3);	}	document.getElementById("PreisDiv1").innerHTML = FCommaEUR(tempSumme)+"&nbsp;€";	document.getElementById("PreisDiv3").innerHTML = FCommaEUR(tempSumme)+"&nbsp;€";		if(EinkaufswagenArr.length>0){		document.getElementById("goToCheckoutButton").style.display = "inline-block";	}else{		document.getElementById("goToCheckoutButton").style.display = "none";	}}function switchToWish(idx){	if(UserID==0 && VorlaufigUserID!="" && VorlaufigKaufwagenArr.length>0){		for(var i=0; i<VorlaufigKaufwagenArr.length; i++){			if(VorlaufigKaufwagenArr[i][0]==EinkaufswagenArr[idx].EinkaufswagenInt2){				VorlaufigKaufwagenArr.splice(i,1);				var storage = window.sessionStorage;									storage.setItem('VorlaufigKaufwagenArr',JSON.stringify(VorlaufigKaufwagenArr));				VorlaufigWunschlisteArr.push(VorlaufigKaufwagenArr[i][1]);									storage.setItem('VorlaufigWunschlisteArr',JSON.stringify(VorlaufigWunschlisteArr));				switchToWishSuccess(idx);				break;			}		}	}else if(UserID!=0){		$.ajax({		  type: "POST",			 url: "https://ajax.leuchtkunstrahmen.com/frontend_einkaufswagen_AJAX.asp",			 data:{				 "opt":3,				 "UserID": UserID,				 "oneEinkaufswagen":JSON.stringify(EinkaufswagenArr[idx]),			 },			 cache: false,			 success: function (response) {				switchToWishSuccess(idx);			 },			 error: function (response) {				console.log(response);			 }		});	}}function switchToWishSuccess(idx){	EinkaufswagenArr.splice(idx,1);					if(EinkaufswagenArr.length>0){		document.getElementById("HeaderCartMengeSpan").innerHTML = parseInt(EinkaufswagenArr.length);		document.getElementById("MobileCartMengeSpan").innerHTML = "Warenkorb("+parseInt(EinkaufswagenArr.length)+")";		document.getElementById("HeaderCartMengeSpan").style.display = "flex";	}else{		document.getElementById("HeaderCartMengeSpan").innerHTML = "0";		document.getElementById("MobileCartMengeSpan").innerHTML = "Warenkorb";		document.getElementById("HeaderCartMengeSpan").style.display = "none";	}		showEinkaufswagen();}function DeleteFromCart(idx){	if(UserID==0 && VorlaufigUserID!="" && VorlaufigKaufwagenArr.length>0){		for(var i=0; i<VorlaufigKaufwagenArr.length; i++){			if(VorlaufigKaufwagenArr[i][1]==EinkaufswagenArr[idx].EinkaufswagenInt2){				VorlaufigKaufwagenArr.splice(i,1);				var storage = window.sessionStorage;									storage.setItem('VorlaufigKaufwagenArr',JSON.stringify(VorlaufigKaufwagenArr));				DeleteFromCartSuccess(idx);				break;			}		}	}else if(UserID!=0){			$.ajax({			type: "POST",			url: "/frontend_einkaufswagen_5",			contentType: 'application/x-www-form-urlencoded',			async: false, 			data: {				 "UserID": UserID,				 "prIDX": EinkaufswagenArr[idx].prIDX,			},			success: function (response) {				DeleteFromCartSuccess(idx);			}		});		}}function DeleteFromCartSuccess(idx){	if(parseInt(EinkaufswagenArr.length-1)>0){	document.getElementById("HeaderCartMengeSpan").innerHTML = parseInt(EinkaufswagenArr.length-1);	document.getElementById("MobileCartMengeSpan").innerHTML = "Warenkorb("+parseInt(EinkaufswagenArr.length-1)+")";	document.getElementById("HeaderCartMengeSpan").style.display = "flex";	}else{		document.getElementById("HeaderCartMengeSpan").innerHTML = parseInt(EinkaufswagenArr.length-1);		document.getElementById("MobileCartMengeSpan").innerHTML = "Warenkorb";		document.getElementById("HeaderCartMengeSpan").style.display = "none";	}	 	EinkaufswagenArr.splice(idx,1);	showEinkaufswagen();}function setProduktBearbeitenButton(idx){	document.getElementById("MobileButtonDiv"+idx).innerHTML = ""+		"<a href='javascript:switchToWish("+idx+")' style='display:inline-block;'><div style='width:140px;border:1px solid #fd7e14;border-radius:5px;padding:5px;color:#fd7e14;text-align:center;font-size:12px;'>Auf die Wunschliste</div></a>&nbsp;&nbsp;"+		"<a href='javascript:DeleteFromCart("+idx+")' style='display:inline-block;'><div style='width:80px;border:1px solid #dc3545;border-radius:5px;padding:5px;color:#dc3545;text-align:center;font-size:12px;'>Löschen</div></a>&nbsp;&nbsp;"+		"<a href='javascript:returnProduktBearbeitenButton("+idx+")' style='display:inline-block;'><div style='width:50px;border:1px solid #0d6efd;border-radius:5px;padding:5px;color:#0d6efd;text-align:center;font-size:12px;'>X</div></a>";}function returnProduktBearbeitenButton(idx){	document.getElementById("MobileButtonDiv"+idx).innerHTML = ""+		"<button class='btn' onclick='setProduktBearbeitenButton("+idx+")' style='width:100%;border:1px solid #0d6efd;color:#0d6efd;padding: 5px 10px;'>Bearbeiten</button>";}function setProduktMengeA(opt,idx,AngebotPreis){	var value = parseInt(document.getElementById("ProduktMengeSpanA"+idx).value);	if(opt==1){		if(value>1){			//document.getElementById("ProduktMengeSpanA"+idx).value = parseInt(value-1);			document.getElementById("ZwischensummeDiv"+idx).innerHTML = FCommaEUR(parseFloat(parseInt(value-1)*AngebotPreis));			EinkaufswagenArr[idx].EinkaufswagenInt3 = parseInt(value-1);		}	}else if(opt==2){		//document.getElementById("ProduktMengeSpanA"+idx).value = parseInt(value+1);		document.getElementById("ZwischensummeDiv"+idx).innerHTML = FCommaEUR(parseFloat(parseInt(value+1)*AngebotPreis));		EinkaufswagenArr[idx].EinkaufswagenInt3 = parseInt(value+1);	}			if(UserID==0 && VorlaufigUserID!="" && VorlaufigKaufwagenArr.length>0){		for(var i=0; i<VorlaufigKaufwagenArr.length; i++){			if(VorlaufigKaufwagenArr[i][1]==EinkaufswagenArr[idx].EinkaufswagenInt2){				VorlaufigKaufwagenArr[i][2] = parseInt(EinkaufswagenArr[idx].EinkaufswagenInt3);				var storage = window.sessionStorage;									storage.setItem('VorlaufigKaufwagenArr',JSON.stringify(VorlaufigKaufwagenArr));				break;			}		}	}		setTotalPreis();}function setProduktMengeB(opt,idx,AngebotPreis){	var value = parseInt(document.getElementById("ProduktMengeSpanB"+idx).value);	if(opt==1){		if(value>1){			document.getElementById("ProduktMengeSpanB"+idx).value = parseInt(value-1);			EinkaufswagenArr[idx].EinkaufswagenInt3 = parseInt(value-1);		}	}else if(opt==2){		document.getElementById("ProduktMengeSpanB"+idx).value = parseInt(value+1);		EinkaufswagenArr[idx].EinkaufswagenInt3 = parseInt(value+1);	}	setTotalPreis();}function saveEinkaufswagen(idx){		if(UserID==0 && VorlaufigUserID!="" && VorlaufigKaufwagenArr.length>0){		var storage = window.sessionStorage;							storage.setItem('VorlaufigKaufwagenArr',JSON.stringify(VorlaufigKaufwagenArr));				window.location.href = '/kasse';	}else if(UserID!=0){			$.ajax({			type: "POST",			url: "/frontend_einkaufswagen_4",			contentType: 'application/x-www-form-urlencoded',			async: false, 			data: {				EinkaufswagenArr: JSON.stringify(EinkaufswagenArr),			},			success: function (response) {				window.location.href = "/kasse";			}		});	}}//用于提取子产品的属性名function extractStringInfo(inputString) {	const pattern = /#([^;]+);?/g;	var match;	var result = [];	// 使用循环查找所有匹配项	while ((match = pattern.exec(inputString)) !== null) {	// 将匹配到的字符串添加到结果数组中	result.push(match[1]);	}	return result;}